{%- comment -%}
================================================================================
CORE HEAD — Essential <head> Contents
================================================================================
Loads metadata, stylesheets, and critical scripts.
Organized by priority for optimal loading.
================================================================================
{%- endcomment -%}

{%- comment -%} Character encoding — must be first {%- endcomment -%}
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

{%- comment -%} Security Headers {%- endcomment -%}
<meta http-equiv="X-Frame-Options" content="SAMEORIGIN">
<meta http-equiv="X-Content-Type-Options" content="nosniff">
<meta http-equiv="Permissions-Policy" content="camera=(), microphone=(), geolocation=(), interest-cohort=()">

{%- comment -%} SEO & Social Meta {%- endcomment -%}
{% include metadata.liquid %}

{%- comment -%} Favicon {%- endcomment -%}
<link rel="icon" href="{{ '/assets/favicon/favicon_io/favicon.ico' | relative_url }}" type="image/x-icon">
{%- if site.icon.size <= 4 -%}
  <link rel="shortcut icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>{{ site.icon }}</text></svg>">
{%- elsif site.icon != blank -%}
  <link rel="shortcut icon" href="{{ site.icon | prepend: '/assets/img/' | relative_url | bust_file_cache }}">
{%- endif -%}

{%- comment -%} Canonical URL {%- endcomment -%}
<link rel="canonical" href="{{ page.url | replace:'index.html','' | absolute_url }}">

{%- comment -%} 
================================================================================
STYLESHEETS — Organized by Priority
================================================================================
{%- endcomment -%}

{%- comment -%} 1. Critical CSS — Bootstrap framework {%- endcomment -%}
<link rel="stylesheet" href="{{ '/assets/css/bootstrap.min.css' | relative_url | bust_file_cache }}">
<link rel="stylesheet" href="{{ site.third_party_libraries.mdb.url.css }}" integrity="{{ site.third_party_libraries.mdb.integrity.css }}" crossorigin="anonymous">

{%- comment -%} 2. Icon Fonts (defer when possible) {%- endcomment -%}
<link defer rel="stylesheet" href="{{ '/assets/css/academicons.min.css' | relative_url | bust_file_cache }}">

{%- comment -%} 3. Web Fonts {%- endcomment -%}
<link defer rel="stylesheet" type="text/css" href="{{ site.third_party_libraries.google_fonts.url.fonts }}">
{%- if site.third_party_libraries.adobe_fonts.url.fonts -%}
  <link defer rel="stylesheet" type="text/css" href="{{ site.third_party_libraries.adobe_fonts.url.fonts }}">
{%- endif -%}

{%- comment -%} 4. Syntax Highlighting {%- endcomment -%}
<link defer rel="stylesheet" href="{{ '/assets/css/jekyll-pygments-themes-github.css' | relative_url | bust_file_cache }}" media="" id="highlight_theme_light">

{%- comment -%} 5. Main Stylesheet — Our custom styles {%- endcomment -%}
<link rel="stylesheet" href="{{ '/assets/css/main.css' | relative_url | bust_css_cache }}">

{%- comment -%} 
================================================================================
CONDITIONAL STYLESHEETS — Page-specific
================================================================================
{%- endcomment -%}

{%- comment -%} Table of Contents sidebar {%- endcomment -%}
{%- if page.toc and page.toc.sidebar -%}
  <link defer href="{{ '/assets/css/bootstrap-toc.min.css' | relative_url | bust_file_cache }}" rel="stylesheet">
{%- endif -%}

{%- comment -%} Bootstrap Table {%- endcomment -%}
{%- if page.pretty_table -%}
  <link defer rel="stylesheet" href="{{ site.third_party_libraries.bootstrap-table.url.css }}" integrity="{{ site.third_party_libraries.bootstrap-table.integrity.css }}" crossorigin="anonymous">
{%- endif -%}

{%- comment -%} Pseudocode {%- endcomment -%}
{%- if page.pseudocode -%}
  <link defer rel="stylesheet" href="{{ site.third_party_libraries.pseudocode.url.css }}" integrity="{{ site.third_party_libraries.pseudocode.integrity.css }}" crossorigin="anonymous">
{%- endif -%}

{%- comment -%} Map (Leaflet) {%- endcomment -%}
{%- if page.map -%}
  <link defer rel="stylesheet" href="{{ site.third_party_libraries.leaflet.url.css }}" integrity="{{ site.third_party_libraries.leaflet.integrity.css }}" crossorigin="anonymous">
{%- endif -%}

{%- comment -%} Code Diff {%- endcomment -%}
{%- if page.code_diff -%}
  <link defer rel="stylesheet" href="{{ site.third_party_libraries.highlightjs.url.css.light }}" integrity="{{ site.third_party_libraries.highlightjs.integrity.css.light }}" crossorigin="anonymous" media="screen and (prefers-color-scheme: light)">
  <link defer rel="stylesheet" href="{{ site.third_party_libraries.highlightjs.url.css.dark }}" integrity="{{ site.third_party_libraries.highlightjs.integrity.css.dark }}" crossorigin="anonymous" media="screen and (prefers-color-scheme: dark)">
  <link defer rel="stylesheet" href="{{ site.third_party_libraries.diff2html.url.css }}" integrity="{{ site.third_party_libraries.diff2html.integrity.css }}" crossorigin="anonymous">
{%- endif -%}

{%- comment -%} Image Comparison {%- endcomment -%}
{%- if page.images and page.images.compare -%}
  <link defer rel="stylesheet" href="{{ site.third_party_libraries.img-comparison-slider.url.css }}" integrity="{{ site.third_party_libraries.img-comparison-slider.integrity.css }}" crossorigin="anonymous">
{%- endif -%}

{%- comment -%} Swiper — Always loaded (used for funding carousel, galleries) {%- endcomment -%}
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.css">

{%- comment -%} 
================================================================================
DARK MODE — Theme initialization
================================================================================
{%- endcomment -%}
<script src="{{ '/assets/js/theme.js' | relative_url | bust_file_cache }}"></script>
{%- if site.enable_darkmode -%}
  <link defer rel="stylesheet" href="{{ '/assets/css/jekyll-pygments-themes-native.css' | relative_url | bust_file_cache }}" media="none" id="highlight_theme_dark">
  <script>initTheme();</script>
{%- endif -%}

{%- comment -%} Cross-Domain Configuration {%- endcomment -%}
{% include cross-domain-config.liquid %}
